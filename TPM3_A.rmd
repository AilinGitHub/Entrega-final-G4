---
title: "TPM3"
author: "Grupo 4"
date: "2024-04-25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Integrantes Grupo 4

* Graff Ailin
* Lopez Leandro
* Maglione Nicolas
* Sacchi Gina


## Introducción

El siguiente trabajo tiene como objetivo aplicar los conocimientos aprendidos durante el MÓDULO 3: Tecnologías Emergentes en los procesos Productivos - de la Diplomatura Universitaria en Gestión y Tecnologías para el desarrollo Convencional y No Convencional de Hidrocarburos


Cuerpo Docente

* Profesor: Dr. Ricardo Palma
* Asesor Pedagógico: Mg. Sebastián Miers
* Coordinadora Académica: Mg. Ing. Andrea Caballero
* Coordinadora Logística: Dra. Gabriela del Hoyo


En base al dataset elegido, el objetivo es analizar los valores de producción y gas de los pozos no convencionales de YPF para el mes de marzo 2024.



## Metdología - paquetes de datos a utilizar


Para el trabajo se emplearon los siguientes paquetes. Si no están isntalados, habrá que usar la función install.packages()


```{r}
library(tidyverse)
library(cluster)
library(factoextra)
library(ggplot2)
library(maps)
library(sf)
library(leaflet)
library(readr)
library(readxl)
library(stats)
library(png)
library(ucminf)
library(orloca)
library(leaflet)
library(leaflet.extras)
library(dplyr)

```



## Carga del dataset (CSV)

Vamos a comenzar a trabajar con el dataset de nación Producción de Pet y Gas No convencional del mes de marzo de 2024. Para el mismo se filtraron los valores, para que queden únicamente los pozos de YPF. 


La ubicación de esta tabla puede ser recuperado de:
[Producción_NC_YPF](https://github.com/AilinGitHub/Entrega-final-G4/blob/main/Produccion%20NC%20YPF.csv)


Para leer el conjunto de datos:



```{r}
library(readr)
Produccion_NC_YPF <- read_delim("Produccion NC YPF.csv", 
    delim = ";", escape_double = FALSE, col_types = cols(prod_gas = col_double(), 
        coordenadax = col_number(), coordenaday = col_number()), 
    trim_ws = TRUE)
View(Produccion_NC_YPF)
```



Asignación de la tabla como "datos" para simplificar el trabajo


```{r}
datos <- Produccion_NC_YPF
```





### Trabajo con los datos

A partir de la tabla, comenzaremos a utilizar algunas de las variables aprendidas en el desarrollo del curso, para explorar el contenido de la tabla.


  1. Comenzaremos con el encabezado de nuestra tabla utilizando el comando "names"

```{r}
names(datos)
```
De estos datos, podemos identificar sobre cuales analizaremos a lo largo del trabajo. En este caso, vemos que los datos de producción de petróloeo y gas son los de mayor interés.





  2. Para ver las dimensiones (filas y columnas) colocamos el comando dim

```{r}
dim(datos)
```

En total hay 2108 pozos declarados, en el perdíodo de estudio.



  3. Cabecera de la tabla

```{r}
head(datos)
```


  4. Pie de la tabla

```{r}
tail(datos)
```

## ASIGNACIÓN DE VARIABLES


```{r}
ProdPet <-(datos$prod_pet)
ProdGas <-(datos$prod_gas)
TipoEstado <- c(datos$tipoestado)
Sigla <- c(datos$sigla)
```


## ANÁLISIS ESTADO DE POZOS

* Cantidad de pozos por "Estado de pozo"


```{r}
EEF <- nrow(subset(datos, datos$tipoestado == "Extraccion Efectiva"))
ES <- nrow(subset(datos, datos$tipoestado == "En Estudio"))
PT <- nrow(subset(datos, datos$tipoestado == "Parado Transitoriamente"))
ARGP <- nrow(subset(datos, datos$tipoestado == "Parado Alta Relacion Gas/Petroleo"))
EER <- nrow(subset(datos, datos$tipoestado == "En Espera de Reparacion"))	
EIE <- nrow(subset(datos, datos$tipoestado == "En Inyeccion Efectiva"))	
AT <- nrow(subset(datos, datos$tipoestado == "Abandono Temporario"))	
A <- nrow(subset(datos, datos$tipoestado == "Abandonado"))
EE <- nrow(subset(datos, datos$tipoestado == "En Estudio"))
AA <- nrow(subset(datos, datos$tipoestado == "A Abandonar"))
ER <- nrow(subset(datos, datos$tipoestado == "En Reparacion"))
ERG <- nrow(subset(datos, datos$tipoestado == "En Reserva de Gas"))
RRSA <- nrow(subset(datos, datos$tipoestado == "En Reserva para Recup. Sec./Asist."))
OCI <- nrow(subset(datos, datos$tipoestado == "Otras Situacion Inactivo"))

data.frame(EEF, ES, RRSA, ARGP, PT, ERG, EER, ER, EIE , AT, EE, OCI, A, AA)
```

```{r}
tipo_de_extraccion<- C(datos$tipoextraccion)

prod.tipoextraccion<- data.frame(tipo_de_extraccion,ProdPet,ProdGas)

head(prod.tipoextraccion)
```


```{r}
ggplot(prod.tipoextraccion, aes(x = tipo_de_extraccion, y = ProdGas, col = ProdPet, group = ProdPet)) + geom_point() + geom_line() + coord_polar()
```

```{r}
ggplot(prod.tipoextraccion, aes(x = tipo_de_extraccion, y = ProdGas, col = ProdPet, group = ProdPet)) + 
  geom_polygon(fill = NA) + coord_polar()
```


```{r}
Surgencia_Natural_Pet<- sum(subset(prod.tipoextraccion$ProdPet,tipo_de_extraccion=="Surgencia Natural"))

Plunger_Lift_Pet<- sum(subset(prod.tipoextraccion$ProdPet,tipo_de_extraccion=="Plunger Lift"))

Bombeo_Mecanico_Pet<- sum(subset(prod.tipoextraccion$ProdPet,tipo_de_extraccion=="Bombeo Mecanico"))

Gas_Lift_Pet<- sum(subset(prod.tipoextraccion$ProdPet,tipo_de_extraccion=="Gas Lift"))

## se calculo el total de produccion de petroleo por cada metodo aplicado



Surgencia_Natural_gas<- sum(subset(prod.tipoextraccion$ProdGas,tipo_de_extraccion=="Surgencia Natural"))

Plunger_Lift_gas<- sum(subset(prod.tipoextraccion$ProdGas,tipo_de_extraccion=="Plunger Lift"))

Bombeo_Mecanico_gas<- sum(subset(prod.tipoextraccion$ProdGas,tipo_de_extraccion=="Bombeo Mecanico"))

Gas_Lift_gas<- sum(subset(prod.tipoextraccion$ProdGas,tipo_de_extraccion=="Gas Lift"))

## se calculo el total de produccion de gas por cada metodo aplicado


```




```{r}
sistema_extraccion<- c("Surgencia Natural","Plunger Lift","Bombeo Mecanico","Gas Lift")

total_pet_por_sistema<- c(Surgencia_Natural_Pet,Plunger_Lift_Pet,Bombeo_Mecanico_Pet,Gas_Lift_Pet)

total_gas_por_sistema<- c(Surgencia_Natural_gas,Plunger_Lift_gas,Bombeo_Mecanico_gas,Gas_Lift_gas)

data.frame(sistema_extraccion,total_pet_por_sistema,total_gas_por_sistema)
```











A continuación, se observa la producción de Pet y Gas de estos pozos.

```{r}
dataf_tipoestado <- data.frame(Sigla, TipoEstado, ProdGas, ProdPet)

```








## ANÁLISIS DE PRODUCCIÓN

En esta sección, analizaremos los valores de pruducción de petróleo y gas.


### Producción de PETRÓLEO


* Producción total Pet NC - YPF 

```{r}
sum(ProdPet)
```


* Obtenemos los principales datos estadísticos con el comando summary

```{r}
summary(ProdPet)
```

De estos datos, se observa que la máxima producción de petróleo de uno de los pozos es de 7390.03 m3/d mientras que la menor es de 0 (pozos parados).
La producción promedio del conjunto de pozos no convencionales para el mes de marzo fue de 490m3/d.




A continuación, haremos gráficos analizando estos valores:



```{r}

plot(sort(ProdPet))
plot(ProdPet, col='steelblue', ,, main = "Distribución de Producción de Petróleo en pozos NC - YPF")

hist(ProdPet, col='steelblue', xlab = 'Prod Pet m3/d', ylab = 'Numero de pozos', main = "Distribución de Producción de Petróleo en pozos NC - YPF")
abline(v = mean(ProdPet), col='red', lwd = 1)
```

### Producción de GAS


* Producción total GAS NC - YPF 

```{r}
sum(ProdGas)
```


* Obtenemos los principales datos estadísticos con el comando summary

```{r}
summary(ProdGas)
```

De estos datos, se observa que la máxima producción de GAS de uno de los pozos es de 14212.68 Mm3/d mientras que la menor es de 0 (pozos parados).
La producción promedio del conjunto de pozos no convencionales para el mes de marzo fue de 356.93Mm3/d.




A continuación, haremos gráficos analizando estos valores:



```{r}

plot(sort(ProdGas))

hist(ProdGas, col='steelblue', xlab = 'Prod Gas Mm3/d', ylab = 'Numero de pozos', main = "Distribución de Producción de GAS en pozos NC - YPF")
abline(v = mean(ProdPet), col='blue', lwd = 1)
```
### RELACION PET/GAS


```{r}
plot(Produccion_NC_YPF$prod_pet,Produccion_NC_YPF$prod_gas)
abline(h = mean(ProdPet), col="red")
abline(v = mean(ProdGas), col="blue")
```



## Profundidad de los Pozos


```{r}
summary(datos$profundidad)
```

Si bien es un dato relativo, porque mucho de los pozos son horizontales, se podria desprender de estos valores que el promedio de profundiad de los pozos es de 3935m. El máximo valor corresponde a 7784 (por el valor se interpreta que incluye el tramo horizontal) y que los pozos con valor de profundiad 0 son los que no tienen cargados estos datos en el dataset.



* Gráfica de las profundidades


```{r}

plot(datos$profundidad,  col='steelblue', xlab = 'Pozos', ylab = 'Profundidad', main = "Profundidad de los pozos NC - YPF")
```




## REPRESENTACIÓN GEOGRÁFICA DE LOS POZOS (MAPA DE UBICACIÓN)

* Análisis de la cantidad de pozos por provincia






* Plot general de los datos (x,y)


```{r}


plot(datos$coordenadax, datos$coordenaday)
```


```{r}

inventario <- datos
   

```

```{r}
puntos <- data.frame(inventario)
```





```{r}

# Realizamos clustering con k-means

kmeans_r <- kmeans(datos [, c("coordenadax", "coordenaday")], centers = 4)

```



```{r}

# Añadimos la clasificación de clusters a la tabla de datos
datos$cluster <- kmeans_r$cluster

```


```{r}

# PASO 4. Convertir a un objeto sf para poder graficar en un mapa
mapa_sf <- st_as_sf(datos, coords = c('coordenadax', 'coordenaday'), crs = 4326)

```



```{r}


# PASO 5. Obtener el mapa de Argentina
argentina_map <- st_as_sf(maps::map('world', 'argentina', plot = FALSE, fill = TRUE))
```



```{r}

# PASO 6. Graficar un mapa con los clusters (Mapa sencillo con ggplot)
ggplot() +
  geom_sf(data = argentina_map, fill = 'lightgrey', color = 'white') +
  geom_sf(data = mapa_sf, aes(color = factor(cluster)), size = 2, alpha = 0.7) +
  labs(color = 'Cluster') +
  theme_minimal() +
  ggtitle('Pozos NC - YPF en Argentina')

```



```{r}

# PASO 7. Crear un mapa interactivo con leaflet

mapa <- leaflet(datos) %>%
  addTiles() %>%  
  addCircleMarkers(lng = ~coordenaday, lat = ~coordenadax, popup = ~as.character(cluster), color = ~factor(cluster), clusterOptions = markerClusterOptions()) %>%
  addProviderTiles(providers$CartoDB.Positron)


```



```{r}
## PASO 8. Creacion de un Mapa Georeferenciado

activos <- data.frame(
  lat = puntos$coordenaday,
  long = puntos$coordenadax,
    stringsAsFactors = FALSE
)
```


```{r}
## PASO 9. convierte la codificación de un vector de caracteres de una codificación a otra. 


leaflet(data = activos[1:299, ]) %>%
  addTiles() %>%
  addMarkers(
    lng = ~long, 
    lat = ~lat, )
```



Agradecemos al compañero Juan Faneite por facilitarnos los códigos de los mapas del proyecto, que luego fueron adaptados para este caso en particular.

